<!-- Filtreleme -->
<div class="filter-search">
  <input
    type="text"
    placeholder="Personel Ara..."
    [(ngModel)]="searchText"
    (input)="filterPersonnel()"
  />

  <select [(ngModel)]="selectedDepartment" (change)="filterPersonnel()">
    <option value="">TÃ¼m Departmanlar</option>
    <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.name }}</option>
  </select>
</div>

<!-- Kartlar -->
<div class="card-container">
  <div class="content-card" *ngFor="let person of paginatedPersonnel">
    <div class="personnel-image">
      <img [src]="person.personnelPhoto" alt="personnel" />
    </div>
    <div class="personnel-info">
      <h3 class="personnel-name">{{ person.firstName }} {{ person.lastName }}</h3>
      <p class="personnel-title">{{ person.position }}</p>
    </div>
    <div>
      <button class="btn" (click)="openDetails(person)">Daha Fazla</button>
    </div>
  </div>
</div>

<!-- PAGINATION ÅžIK TASARIM -->
<div class="pagination-bar" *ngIf="totalPages > 1">
  <button class="pagination-btn" (click)="goToPreviousPage()" [disabled]="currentPage === 1">
    &#8592; Ã–nceki
  </button>
  <span class="pagination-info">
    Sayfa <b>{{ currentPage }}</b> / {{ totalPages }}
  </span>
  <button class="pagination-btn" (click)="goToNextPage()" [disabled]="currentPage === totalPages">
    Sonraki &#8594;
  </button>
</div>

<!-- Ekleme Formu -->
<button class="bton" (click)="toggleAddForm()">Yeni Personel Ekle</button>
<div *ngIf="showAddForm" class="add-person-detail">
  <h2 class="yeni-personel-yazisi">Yeni Personel</h2>
  <form (ngSubmit)="addPersonnel()">
    <label>Ad:
      <input [(ngModel)]="newPersonnel.firstName" name="firstName" required />
    </label>
    <label>Soyad:
      <input [(ngModel)]="newPersonnel.lastName" name="lastName" required />
    </label>
    <label>Tc Kimlik NumarasÄ±:
      <input [(ngModel)]="newPersonnel.tckimlik" name="tckimlik" required />
    </label>
    <label>DoÄŸum Tarihi:
      <input [(ngModel)]="newPersonnel.dogumTarihi" name="dogumTarihi" type="date" required />
    </label>
    <label>Telefon NumarasÄ±:
      <input [(ngModel)]="newPersonnel.telNo" name="telNo" />
    </label>
    <label>Adres:
      <input [(ngModel)]="newPersonnel.adres" name="adres" />
    </label>
    <label>Email:
      <input [(ngModel)]="newPersonnel.email" name="email" />
    </label>
    <label>Depatman:
      <select [(ngModel)]="newPersonnel.departmentId" name="departmentId" required>
        <option value="">SeÃ§iniz</option>
        <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.name }}</option>
      </select>
    </label>
    <label>Pozisyon:
      <input [(ngModel)]="newPersonnel.position" name="position" />
    </label>
    <label>BaÅŸlangÄ±Ã§ Tarihi:
      <input [(ngModel)]="newPersonnel.startDate" name="startDate" type="date" />
    </label>
    <label>FotoÄŸraf:
      <input type="file" accept="image/*" (change)="handleFileInput($event)" required />
    </label>

    <div class="butons">
      <button class="persekle" type="submit">Ekle</button>
      <button class="kutukapat" type="button" (click)="toggleAddForm()">Kapat</button>
    </div>
  </form>
</div>

<!-- Personel Detay Popup -->
<div *ngIf="isCardVisible">
  <div class="modal-backdrop" (click)="closeDetails()"></div>
  <div class="card-person-detail" [ngClass]="{ 'editing': isEditMode }">
    <h2>ðŸ‘¤ Personel Bilgileri</h2>

    <div class="person-photo-wrapper">
      <img [src]="selectedPersonnel?.personnelPhoto" alt="Personnel" />
      <label *ngIf="isEditMode" class="photo-upload-btn" title="FotoÄŸrafÄ± DeÄŸiÅŸtir">
        <input type="file" accept="image/*" (change)="handleFileInput($event)" hidden />
      </label>
    </div>

    <div class="details-grid">
      <div class="detail-row">
        <span class="label">Ad:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.firstName }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.firstName" name="firstName" />
      </div>

      <div class="detail-row">
        <span class="label">Soyad:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.lastName }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.lastName" name="lastName" />
      </div>

      <div class="detail-row">
        <span class="label">TC Kimlik:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.tckimlik }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.tckimlik" name="tckimlik" />
      </div>

      <div class="detail-row">
        <span class="label">DoÄŸum Tarihi:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.dogumTarihi | date:'dd.MM.yyyy' }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.dogumTarihi" type="date" name="dogumTarihi" />
      </div>

      <div class="detail-row">
        <span class="label">Telefon:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.telNo }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.telNo" name="telNo" />
      </div>

      <div class="detail-row">
        <span class="label">Adres:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.adres }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.adres" name="adres" />
      </div>

      <div class="detail-row">
        <span class="label">Email:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.email }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.email" type="email" name="email" />
      </div>

      <div class="detail-row">
        <span class="label">Departman:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.departmentName }}</span>
        <select *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.departmentId" name="departmentId">
          <option value="">SeÃ§iniz</option>
          <option *ngFor="let dept of departments" [ngValue]="dept.id">{{ dept.name }}</option>
        </select>
      </div>

      <div class="detail-row">
        <span class="label">Pozisyon:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.position }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.position" name="position" />
      </div>

      <div class="detail-row">
        <span class="label">BaÅŸlangÄ±Ã§ Tarihi:</span>
        <span class="value" *ngIf="!isEditMode">{{ selectedPersonnel?.startDate | date:'dd.MM.yyyy' }}</span>
        <input *ngIf="isEditMode" [(ngModel)]="selectedPersonnel!.startDate" type="date" name="startDate" />
      </div>
    </div>

    <div class="message-container">
      <div *ngIf="successMessage" class="message success-message">{{ successMessage }}</div>
      <div *ngIf="errorMessage" class="message error-message">{{ errorMessage }}</div>
    </div>

    <div class="form-buttons">
      <button *ngIf="!isEditMode" type="button" class="edit-btn" (click)="editDetails(selectedPersonnel)">DÃ¼zenle</button>
      <button *ngIf="isEditMode" type="button" class="save-btn" (click)="saveDetails()">Kaydet</button>
      <button type="button" class="delete-btn" (click)="deletePersonnel(selectedPersonnel!.id!)">Sil</button>
      <button type="button" class="cancel-btn" (click)="closeDetails()">Kapat</button>
    </div>
  </div>
</div>